<g class="connection">  
  <g ng-class="{ selected: state.isSelected }">
    <g 
      ng-repeat="segment in anchorSegments" 
      ng-switch="segment.type"
      bp-selectable="data"
      on-selection-changed="state.isSelected = $selected"
      ng-style="{ 'marker-end': $last ? 'url(#marker-connection-activate)' : 'none' }"
    >
      <path ng-switch-when="L" ng-attr-d="{{ 'M'+(segment.source | coordinate)+' L'+(segment.destination | coordinate) }}" />
      <path ng-switch-when="Q" ng-attr-d="{{ 'M'+(segment.source | coordinate)+' Q'+(segment.handle | coordinate)+' '+(segment.destination | coordinate) }}" />
      <path ng-switch-when="C" ng-attr-d="{{ 'M'+(segment.source | coordinate)+' C'+(segment.outHandle | coordinate)+' '+(segment.inHandle | coordinate)+' '+(segment.destination | coordinate) }}" />
    </g>
    <g ng-if="canEdit">
      <g ng-repeat="anchor in data.$attributes.anchors.$models">
        <bp-anchor anchor="anchor" />
      </g>
    </g>
  </g>  
</g>